<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Prosthetic Optimizer | YUVAi 2025</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js for Pareto front -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.0.1/dist/chart.umd.js"></script>

    <!-- External CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/animations.css">
  </head>

  <body class="p-4">
    <!-- Header -->1
    <div class="max-w-7xl mx-auto mb-6">
      <div class="bg-white rounded-lg shadow-xl p-6">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">
          ü§ñ AI Prosthetic Optimizer
        </h1>
        <p class="text-gray-600">
          Multi-objective design optimization using NSGA-II + ML surrogates |
          YUVAi Global Youth Challenge 2025
        </p>
      </div>
    </div>

    <!-- Main Content -->
  <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Left Panel: Controls -->
      <div class="bg-white rounded-lg shadow-xl p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Design Parameters</h2>

        <div class="space-y-4">
          <!-- Load Input -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Applied Load (Newtons)
            </label>
            <input
              type="number"
              id="load-input"
              value="50"
              min="10"
              max="200"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            />
            <p class="text-xs text-gray-500 mt-1">
              Force applied to prosthetic bracket
            </p>
          </div>

          <!-- Material Selection -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Material
            </label>
            <select
              id="material-select"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
              <option value="PLA">PLA (3D Printing) - ‚Çπ25/kg</option>
              <option value="Aluminum6061">Aluminum 6061-T6 - ‚Çπ350/kg</option>
              <option value="Steel1045">Steel 1045 - ‚Çπ80/kg</option>
            </select>
          </div>

          <!-- Optimization Settings -->
          <div class="bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-700 mb-2">Advanced Settings</h3>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-600 mb-1"
                  >Population Size</label
                >
                <input
                  type="number"
                  id="pop-size"
                  value="40"
                  min="20"
                  max="100"
                  class="w-full px-3 py-1 border border-gray-300 rounded text-sm"
                />
              </div>
              <div>
                <label class="block text-xs text-gray-600 mb-1"
                  >Generations</label
                >
                <input
                  type="number"
                  id="generations"
                  value="50"
                  min="20"
                  max="200"
                  class="w-full px-3 py-1 border border-gray-300 rounded text-sm"
                />
              </div>
            </div>

            <p class="text-xs text-gray-500 mt-2">
              Higher values = better results but slower (est. 2-4 minutes)
            </p>
          </div>

          <!-- Action Buttons -->
          <div class="space-y-2">
            <button
              id="optimize-btn"
              onclick="runOptimization()"
              class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-semibold"
            >
              üöÄ Run Optimization
            </button>

            <button
              id="demo-btn"
              onclick="loadDemo()"
              class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold"
            >
              ‚ö° Load Demo Results (Instant)
            </button>

            <button
              id="advisor-btn"
              onclick="openMaterialAdvisor()"
              class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition font-semibold"
            >
              üß† Smart Material Advisor
            </button>
          </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="hidden mt-6">
          <!-- NSGA-II Animation -->
          <div id="nsga-animation" class="mb-4">
            <div class="pareto-front-line"></div>
            <!-- Evolving dots -->
            <div class="evolving-dot" style="top: 80%; left: 70%;"></div>
            <div class="evolving-dot" style="top: 75%; left: 65%;"></div>
            <div class="evolving-dot" style="top: 85%; left: 75%;"></div>
            <div class="evolving-dot" style="top: 70%; left: 60%;"></div>
            <div class="evolving-dot" style="top: 90%; left: 80%;"></div>
            <div class="evolving-dot" style="top: 65%; left: 55%;"></div>
            <div class="evolving-dot" style="top: 80%; left: 70%;"></div>
            <div class="evolving-dot" style="top: 75%; left: 65%;"></div>
            <div class="evolving-dot" style="top: 85%; left: 75%;"></div>
            <div class="evolving-dot" style="top: 70%; left: 60%;"></div>
          </div>
          
          <div class="text-center">
            <p class="text-gray-700 font-semibold text-lg mb-1">üß¨ Evolving better designs‚Ä¶</p>
            <p class="text-sm text-gray-500">NSGA-II exploring design space</p>
            <p class="text-xs text-gray-400 mt-2">This may take 2-4 minutes</p>
          </div>
        </div>
      </div>

      <!-- Right Panel: Results -->
      <div class="bg-white rounded-lg shadow-xl p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Pareto Front</h2>

        <div id="results-container" class="hidden">
          <!-- Chart -->
          <div class="mb-4" style="position: relative; height: 300px;">
            <canvas id="pareto-chart"></canvas>

            <!-- Comparison Mode Controls -->
            <div
              class="mt-3 flex items-center justify-between bg-purple-50 p-3 rounded-lg border border-purple-200"
            >
              <div class="text-xs text-gray-700">
                <span class="font-semibold">üí° Tip:</span> Shift+Click on chart
                points or use Compare Mode to select 2 designs
              </div>
              <button
                id="compare-btn"
                onclick="toggleComparisonMode()"
                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold text-sm"
              >
                üîç Compare Designs
              </button>
            </div>
          </div>

          <!-- Comparison Card -->
          <div
            id="comparison-card"
            class="hidden mb-4 bg-gradient-to-r from-green-50 to-amber-50 rounded-lg border-2 border-purple-300 p-4"
          >
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold text-gray-800 flex items-center">
                <span class="text-xl mr-2">‚öñÔ∏è</span>
                Design Comparison
              </h3>
              <button
                onclick="clearComparison()"
                class="text-xs text-gray-600 hover:text-red-600 font-semibold"
              >
                ‚úï Clear
              </button>
            </div>
            <div id="comparison-content">
              <!-- Populated dynamically -->
            </div>
          </div>

          <!-- Selected Design Info -->
          <div id="design-info" class="bg-blue-50 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-800 mb-2">Selected Design</h3>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 text-sm mb-3">
              <div class="bg-white p-2 rounded">
                <span class="text-gray-600">Mass:</span>
                <span class="font-bold text-blue-600" id="info-mass">-</span> g
              </div>
              <div class="bg-white p-2 rounded">
                <span class="text-gray-600">Cost:</span>
                <span class="font-bold text-green-600"
                  >‚Çπ<span id="info-cost">-</span></span
                >
              </div>
              <div class="bg-white p-2 rounded">
                <span class="text-gray-600">Design:</span>
                <span class="font-bold text-purple-600" id="info-id">-</span>
              </div>
            </div>

            <!-- Print Readiness Score -->
            <div
              class="bg-white p-3 rounded-lg border-2"
              id="readiness-container"
            >
              <div class="flex items-center justify-between">
                <span class="text-sm font-semibold text-gray-700"
                  >üè≠ Print Readiness:</span
                >
                <div class="flex items-center space-x-2">
                  <span id="readiness-score" class="text-2xl font-bold">-</span>
                  <span class="text-gray-500">/100</span>
                </div>
              </div>
              <div class="mt-1 text-xs text-gray-500">
                <span id="readiness-time">Print time: ~-h</span>
              </div>
            </div>

            <!-- Sustainability Meter -->
            <div
              class="bg-gradient-to-r from-green-50 to-emerald-50 p-3 rounded-lg border-2 border-green-200 mt-3"
            >
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-semibold text-gray-700"
                  >üçÉ Sustainability</span
                >
              </div>

              <!-- CO2 Emissions -->
              <div class="flex items-center justify-between mb-2">
                <span class="text-xs text-gray-600">CO‚ÇÇ Emissions:</span>
                <span class="text-sm font-bold text-gray-800">
                  <span id="co2-value">-</span> kg
                </span>
              </div>

              <!-- Efficiency Index -->
              <div class="mt-2">
                <div class="flex items-center justify-between text-xs mb-1">
                  <span class="text-gray-600">Efficiency Index:</span>
                  <span class="font-bold text-green-700" id="efficiency-value"
                    >-</span
                  >
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div
                    id="efficiency-bar"
                    class="bg-gradient-to-r from-green-400 to-emerald-600 h-2 rounded-full transition-all duration-500"
                    style="width: 0%"
                  ></div>
                </div>
                <div class="text-xs text-gray-500 mt-1 text-center">
                  Safety Factor / kg (higher is better)
                </div>
              </div>
            </div>

            <!-- Parameters -->
            <div class="mt-3 text-xs">
              <details class="cursor-pointer">
                <summary class="font-semibold text-gray-700">
                  Design Parameters
                </summary>
                <div id="info-params" class="mt-2 space-y-1 text-gray-600">
                  <!-- Populated dynamically -->
                </div>
              </details>
            </div>

            <!-- Download Button -->
            <button
              onclick="downloadManufacturingPack(event, currentDesignId)"
              class="mt-3 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition font-semibold shadow-md"
            >
              üì¶ Download Manufacturing Pack
            </button>
          </div>

          <!-- Designs Table -->
          <div class="mt-4">
            <h3 class="font-semibold text-gray-700 mb-2">All Designs</h3>
            <div class="overflow-x-auto">
              <table id="designs-table" class="min-w-full text-xs">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-2 py-2 text-left cursor-pointer hover:bg-gray-100"
                      onclick="sortTable('id')"
                    >
                      ID
                    </th>
                    <th
                      class="px-2 py-2 text-left cursor-pointer hover:bg-gray-100"
                      onclick="sortTable('mass')"
                    >
                      Mass(g)
                    </th>
                    <th
                      class="px-2 py-2 text-left cursor-pointer hover:bg-gray-100"
                      onclick="sortTable('cost')"
                    >
                      Cost(‚Çπ)
                    </th>
                    <th
                      class="px-2 py-2 text-left cursor-pointer hover:bg-gray-100"
                      onclick="sortTable('print_score')"
                    >
                      Readiness
                    </th>
                    <th
                      class="px-2 py-2 text-left cursor-pointer hover:bg-gray-100"
                      onclick="sortTable('co2_kg')"
                      title="Carbon dioxide emissions"
                    >
                      üçÉ CO‚ÇÇ(kg)
                    </th>
                    <th
                      class="px-2 py-2 text-left cursor-pointer hover:bg-gray-100"
                      onclick="sortTable('efficiency_index')"
                      title="Safety factor per kg"
                    >
                      ‚ö° Efficiency
                    </th>
                  </tr>
                </thead>
                <tbody id="designs-table-body" class="divide-y">
                  <!-- Populated dynamically -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="no-results" class="text-center py-12 text-gray-400">
          <svg
            class="w-16 h-16 mx-auto mb-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
            ></path>
          </svg>
          <p class="font-semibold">No results yet</p>
          <p class="text-sm">
            Run optimization or load demo to see Pareto front
          </p>
        </div>
      </div>
    </div>

    <!-- 3D Viewer Section -->
    <div class="max-w-7xl mx-auto mt-6">
      <div class="bg-white rounded-lg shadow-xl overflow-hidden">
        <button
          onclick="toggle3DViewer()"
          class="w-full p-4 flex items-center justify-between hover:bg-gray-50 transition"
        >
          <h2 class="text-2xl font-bold text-gray-800">
            üé® 3D Model Viewer
          </h2>
          <span id="viewer-toggle-icon" class="text-2xl">‚ñº</span>
        </button>
        <div id="viewer-section" class="hidden">
          <div class="p-6">
            <div id="viewer-container"></div>
            <p class="text-sm text-gray-500 mt-2 text-center">
              Click a point on the Pareto chart to view the 3D model
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Mentor Panel -->
    <div class="max-w-7xl mx-auto mt-6">
      <div
        class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg shadow-xl border-2 border-purple-200 overflow-hidden"
      >
        <button
          onclick="toggleMentor()"
          class="w-full p-4 flex items-center justify-between hover:bg-purple-100 transition"
        >
          <div class="flex items-center">
            <span class="text-3xl mr-3">üéì</span>
            <h2 class="text-2xl font-bold text-gray-800">
              AI Mentor - Optimization Insights
            </h2>
          </div>
          <span id="mentor-toggle-icon" class="text-2xl">‚ñº</span>
        </button>

        <div id="mentor-section" class="hidden p-6">
          <div id="mentor-container" class="hidden">
            <!-- Generation Log -->
            <div class="mb-4">
              <h3 class="font-semibold text-gray-700 mb-2 flex items-center">
                <span class="text-xl mr-2">üìä</span>
                Generation Progress
              </h3>
              <div
                id="mentor-log"
                class="bg-white rounded-lg p-4 max-h-64 overflow-y-auto space-y-2 border border-purple-200"
              >
                <!-- Populated dynamically -->
              </div>
            </div>

            <!-- Summary Insights -->
            <div>
              <h3 class="font-semibold text-gray-700 mb-2 flex items-center">
                <span class="text-xl mr-2">üí°</span>
                Key Insights & Recommendations
              </h3>
              <div
                id="mentor-summary"
                class="bg-white rounded-lg p-4 border border-purple-200 whitespace-pre-line text-sm leading-relaxed"
              >
                <!-- Populated dynamically -->
              </div>
            </div>
          </div>

          <div id="mentor-placeholder" class="text-center py-8 text-gray-400">
          <svg
            class="w-16 h-16 mx-auto mb-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
            ></path>
          </svg>
          <p class="font-semibold">AI Mentor Ready</p>
          <p class="text-sm">
            Run optimization to see intelligent insights and recommendations
          </p>
        </div>
      </div>
    </div>

    <!-- Material Advisor Modal -->
    <div
      id="advisor-modal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
      onclick="closeModalOnBackdrop(event)"
    >
      <div
        class="bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto"
        onclick="event.stopPropagation()"
      >
        <!-- Modal Header -->
        <div
          class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6 rounded-t-lg"
        >
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <span class="text-4xl mr-3">üß†</span>
              <div>
                <h2 class="text-2xl font-bold">Smart Material Advisor</h2>
                <p class="text-purple-100 text-sm">
                  AI-powered material selection guidance
                </p>
              </div>
            </div>
            <button
              onclick="closeMaterialAdvisor()"
              class="text-white hover:text-gray-200 text-3xl font-light leading-none"
            >
              √ó
            </button>
          </div>
        </div>

        <!-- Modal Body -->
        <div class="p-6">
          <!-- Input Form -->
          <div class="mb-6 bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-800 mb-4">
              Tell us about your application
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <!-- Load Input -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Applied Load (N)</label
                >
                <input
                  type="number"
                  id="advisor-load"
                  value="100"
                  min="1"
                  max="1000"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                />
              </div>

              <!-- Environment Selection -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Environment</label
                >
                <select
                  id="advisor-environment"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                >
                  <option value="general">General Use</option>
                  <option value="medical">Medical/Healthcare</option>
                  <option value="industrial">Industrial</option>
                  <option value="outdoor">Outdoor</option>
                </select>
              </div>

              <!-- Budget Selection -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Budget</label
                >
                <select
                  id="advisor-budget"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                >
                  <option value="low">Low (Cost-effective)</option>
                  <option value="medium" selected>Medium (Balanced)</option>
                  <option value="high">High (Premium)</option>
                </select>
              </div>
            </div>

            <button
              onclick="getMaterialAdvice()"
              class="mt-4 w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition font-semibold"
            >
              üîç Get Recommendation
            </button>
          </div>

          <!-- Loading State -->
          <div id="advisor-loading" class="hidden text-center py-8">
            <div class="loading-spinner mx-auto"></div>
            <p class="text-gray-600 mt-2">Analyzing requirements...</p>
          </div>

          <!-- Recommendation Results -->
          <div id="advisor-results" class="hidden">
            <!-- Recommended Material -->
            <div
              class="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300 rounded-lg p-6 mb-4"
            >
              <div class="flex items-start justify-between">
                <div>
                  <h3 class="text-xl font-bold text-gray-800 mb-2">
                    ‚úÖ Recommended Material
                  </h3>
                  <p
                    id="recommended-material"
                    class="text-3xl font-bold text-green-700"
                  >
                    -
                  </p>
                  <p class="text-sm text-gray-600 mt-1">
                    <span class="font-semibold">Manufacturing:</span>
                    <span id="manufacturing-method">-</span>
                  </p>
                </div>
                <div class="text-right text-sm text-gray-600">
                  <div>
                    <span class="font-semibold">Cost:</span>
                    ‚Çπ<span id="material-cost">-</span>/kg
                  </div>
                  <div>
                    <span class="font-semibold">Strength:</span>
                    <span id="material-strength">-</span> MPa
                  </div>
                  <div>
                    <span class="font-semibold">CO‚ÇÇ:</span>
                    <span id="material-co2">-</span> kg/kg
                  </div>
                </div>
              </div>
            </div>

            <!-- Rationale -->
            <div class="mb-4">
              <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                <span class="text-xl mr-2">üí°</span>
                Why this material?
              </h4>
              <ul
                id="rationale-list"
                class="space-y-2 bg-blue-50 p-4 rounded-lg"
              >
                <!-- Populated dynamically -->
              </ul>
            </div>

            <!-- Design Tips -->
            <div class="mb-4">
              <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                <span class="text-xl mr-2">üîß</span>
                Design Recommendations
              </h4>
              <ul
                id="design-tips-list"
                class="space-y-2 bg-yellow-50 p-4 rounded-lg"
              >
                <!-- Populated dynamically -->
              </ul>
            </div>

            <!-- Alternatives -->
            <div id="alternatives-section" class="mb-4 hidden">
              <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                <span class="text-xl mr-2">üîÑ</span>
                Alternative Materials
              </h4>
              <div id="alternatives-list" class="space-y-2">
                <!-- Populated dynamically -->
              </div>
            </div>

            <!-- Material Comparison Table -->
            <div class="mt-6">
              <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                <span class="text-xl mr-2">üìä</span>
                Material Comparison for Your Load
              </h4>
              <div class="overflow-x-auto">
                <table class="min-w-full text-sm bg-white rounded-lg">
                  <thead class="bg-gray-100">
                    <tr>
                      <th class="px-4 py-2 text-left">Material</th>
                      <th class="px-4 py-2 text-center">Safety Factor</th>
                      <th class="px-4 py-2 text-center">Cost (‚Çπ/kg)</th>
                      <th class="px-4 py-2 text-center">CO‚ÇÇ (kg/kg)</th>
                      <th class="px-4 py-2 text-center">Suitability</th>
                    </tr>
                  </thead>
                  <tbody id="comparison-table-body" class="divide-y">
                    <!-- Populated dynamically -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Action Button -->
            <div class="mt-6 text-center">
              <button
                onclick="applyRecommendedMaterial()"
                class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-semibold"
              >
                ‚úì Apply Recommended Material
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-5 right-5 z-50 space-y-2">
      <!-- Toasts dynamically added here -->
    </div>

    <!-- Three.js - LOAD THESE AT THE END -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- JavaScript Modules - Load in order -->
    <script src="js/config.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/api.js"></script>
    <script src="app.js"></script>
  </body>
</html>
